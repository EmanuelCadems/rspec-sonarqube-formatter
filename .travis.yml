language: ruby
os: linux
cache: bundler

env:
  global:
    # This is a write-only ID that can only post test reports.
    - CC_TEST_REPORTER_ID=fe29c7a08645a8e6de55dd7d55b2ae357d92ae9ee154874c900b5a6faa3ec8ec
    - GIT_COMMITTED_AT=$(if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then git log -1 --pretty=format:%ct; else git log -1 --skip 1 --pretty=format:%ct; fi)

rvm:
  - 2.3
  - 2.4
  - 2.5
  - 2.6

before_install: gem install bundler

install:
  - bundle install --retry=3
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build

script:
  - bundle exec rake spec
  - bundle exec rubocop --format progress --format json --out rubocop.json
  - sonar-scanner

after_script:
  - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT

addons:
  sonarcloud:
    organization: otherguy
    token:
      secure: o3T/a0jNWWHRQhsbH2NvdFYbC8fugnWwQD1QUdMR/s2/GzPRTud6eQlBP15bxY3kedEtwXx/368A5urO/ciIQf+OFiG9/fMdLU2PUgZgX8y8OMuD7w3nVHTSbPTj4ZOytMWZwGDThms/yCfYlnc7LaiDJTVWDSMXGU1UCpwyTkxAnr/4rXqK6YMAR4eqFLyzNw2b0JC0C/PRbIU7So4hfzqe4O0DC0VfVmrqRjlp6sfX5/KHPPXSgW/CETpR6JrS4SV7xVjW8nsBXHUFWGl1RCLSUf8CT58kLCO0Vl+OAqcUbTGQJVMlLSYc5YgdFqtacCXw5eJUIb+sCot91IyV2uz98tfhWd8BXolifVUEhsdQd17GpaKHUlT+if28TUUgUMVbLEXoUqwHtfFY6dHjui2oRElFpRYyOlqedcgM1MLzvnK8DGTRWuhuoYZmVUkDsE28vauGP/UWgykLrMc6wFwPW042NMrXzEiifLmXihU+lW4eFYOW0wWP9sKjJxsbuVw4WGbRuhHLjuXwGXOOqoe30nxeNpKcZetSETDjexpYeOTyj205vYuTUPLsrOXU5oEduBmnN3ZNcAY5WoqcTqp8CR++eIEVNq9oqyLrM9t/MRCLv2ndF6VRsJLJ0cD5KGoYj3clJN9R8O6yHpksHO7GIiUGsuzCcMkL9dIWcZ4=

notifications:
  slack:
    secure: vPOzM6Sg5OQKgkzAnKOeSGFwpfslmSynoTJ1UiNa3b4qeZPHqabs+IGe54gtWEepC3YqlcIjZ8pLoKDYJP4xic75RILeeVs1Ya//5/0yiUshE/yKWvHDY7p6ozKo0LAgX9Ean9q5OvMDJXBImoBBmqKyfNOT/IVKMML2d/LwK2MJQuJmOjWQS++f8l4ZTbnoLC59uPP6MvaPf0QktspxTEP5sKjDd/5DDkzkBGueu8jFHzXjkjozrj6rRk1Jiexh9BsNJCFnz3/nurrg1NXCNlFk0BLCcop5VTKjuibSqO+U8x5DAon2nuFz7dVAi7vC8l9fL/pnYhb5x2e2XXt3VtisadG302ysVekFlDCzQ+zD4LudzBQDaOH8OQW+5+noK8qDXV0IAPeKZzT8Nb1/LkJMiNzVQiLHlOYThDGUj9+9qb6MsigzxFUjhTQN5XmarVy7p2xMO5pzNPXIPd2dEJVrabaFWoOL+Qog/Om8GBKmxsToJR8f6oVk8SDK3Q9cPjoZQoujyRiK3acTK+srT+J2nCnPwU0Sy/RRRbvmvIUDwNbJ8jkeYBs0y1aXk8SsMKRqzdrLNq/5YvyjzzMUGzrDdJAkqywwIV0ROLdsqBC+cIPAJoJF7s5b7kTM1EGy01IuLGxJ8EJ3UYOl1KXRzoAafBb6pWEL34Tu0OSMj3Q=

deploy:
  provider: rubygems
  api_key:
    secure: Rg58wNIO6spv5UCOlpTg/7nktLgh/YLAFWNsIxNREbhHzMDFgA/YNA3kRLPtnIMHE3tPQKn6XfGqGDheZC1b3IVQ22BhMCelcFpjXyBneleJ0p0vXmJKsESvGsNps/u1Ima43mOyHMBWgbfgxXxL2B79b87YmCTW3/gYcXHt8h8ECn5BjDvUG6uHyZhRQ8LSPr8RRPtub7M3awQCigkT+iYYjOSzwOa0pL+rmfE04dEVsErnY7Hi408gUtJncHkOMR7zfNY3IsOcxobcHEOs0aYKiV9JRSzva7pm/FqF5F1oJrclt2K8iQRP+ejlADMliWxR75rBZananLo3QLLc4nSxST3l5XaFmKOw6P3XHEZjfJEAGIbWd/aZHW7KxWYWB22A3mrMqqC/3bGE3ihfoA8bU0pakH6PW8Rm2EbMXkS7Ayp60G9K9ACUy97Ph9CwijjV2U5p7j68riMigd4zQXQ5rrmQTTA+0Unulaw/nL28VBuNU7b36TSZFO4JS7/LSUuvddVdjCDLG6sgfuVTCP87PKPeNwfBuvIOOPfn4lhjd707UpythOE3ODvI/Vc40mqDCa3r03Xiapviu0pfA/WWEV3a8BtwDuw6kKoP1SGrPXlkuWhCaHDlVFfxz1JsUKJyJmp4ljegcyF4f2AfT/4/MocROWqxQpQHvHlryqo=
  gem: rspec-sonarqube-formatter
  on:
    repo: otherguy/rspec-sonarqube-formatter
